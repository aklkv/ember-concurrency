<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ember-concurrency</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
<meta name="dummy/config/environment" content="%7B%22modulePrefix%22%3A%22dummy%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%2F%22%2C%22locationType%22%3A%22auto%22%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Afalse%2C%22_TEMPLATE_ONLY_GLIMMER_COMPONENTS%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22ember-concurrency%22%2C%22version%22%3A%222.2.1%2B7a79e000%22%7D%2C%22fastboot%22%3A%7B%22hostWhitelist%22%3A%5B%7B%7D%2C%22ember-concurrency.com%22%5D%7D%2C%22exportApplicationGlobal%22%3Afalse%7D" />
<!-- EMBER_CLI_FASTBOOT_TITLE -->

    <link integrity="" rel="stylesheet" href="/assets/vendor-e754b247f0b14ad5fde0f302404dd7cb.css">
    <link integrity="" rel="stylesheet" href="/assets/dummy-4257be3042dd680ca4a8b02fa35594c9.css">
    <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

    
  </head>
  <body>
    <script type="x/boundary" id="fastboot-body-start"></script><div class="container navbar">
  <div class="row">
    <div class="ten columns">
      <h3 style="float:left;">
        ember-concurrency

        <span style="font-size: 0.5em;">
          (v 2.2.1)
        </span>
      </h3>
    </div>
    <div class="one columns">
      <div class="nav-bar-link-outer">
        <a href="/api">API</a>
      </div>
    </div>
    <div class="one columns">
      <div class="nav-bar-link-outer">
        <a href="https://github.com/machty/ember-concurrency" target="_blank" rel="noopener noreferrer">GitHub</a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="docs row">
    <div class="three columns">
      <div class="side-menu">
            <div class="toc-entry">
                <a id="ember883" class="ember-view" href="/docs/introduction">Home</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember884" class="ember-view" href="/docs/installation">Installation</a>
            </div>


<!---->            <div class="toc-section-title">
              Introduction
            </div>
            <div class="toc-entry">
                <a id="ember885" class="ember-view" href="/docs/tutorial">Writing Code Without Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember886" class="ember-view" href="/docs/tutorial/discussion">Post-Mortem</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember887" class="ember-view" href="/docs/tutorial/refactor">Refactoring With Tasks</a>
            </div>


<!---->            <div class="toc-section-title">
              Reference
            </div>
            <div class="toc-entry">
                <a id="ember888" class="ember-view" href="/docs/task-function-syntax">Task Function Syntax</a>
            </div>


                <div class="toc-entry toc-subentry">
                  <a id="ember889" class="ember-view" href="/docs/task-decorators">Decorators</a>
                </div>
                <div class="toc-entry toc-subentry">
                  <a id="ember890" class="ember-view" href="/docs/typescript">TypeScript</a>
                </div>
            <div class="toc-entry">
                <a id="ember891" class="ember-view" href="/docs/task-concurrency">Managing Task Concurrency</a>
            </div>


                <div class="toc-entry toc-subentry">
                  <a id="ember892" class="ember-view" href="/docs/task-concurrency-advanced">Advanced</a>
                </div>
            <div class="toc-entry">
                <a id="ember893" class="ember-view" href="/docs/cancelation">Cancelation</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember894" class="ember-view" href="/docs/error-vs-cancelation">Handling Errors</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember895" class="ember-view" href="/docs/child-tasks">Child Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember896" class="ember-view" href="/docs/task-groups">Task Groups</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember897" class="ember-view" href="/docs/derived-state">Derived State</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember898" class="ember-view" href="/docs/events">Awaiting Events / Conditions</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember899" class="ember-view" href="/docs/testing-debugging">Testing &amp; Debugging</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember900" class="ember-view" href="/docs/faq">FAQ &amp; Fact Sheet</a>
            </div>


<!---->            <div class="toc-section-title">
              Advanced
            </div>
            <div class="toc-entry">
                <a id="ember901" class="ember-view active" href="/docs/advanced/encapsulated-task">Encapsulated Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember902" class="ember-view" href="/docs/advanced/lifecycle-events">Lifecycle Events</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember903" class="ember-view" href="/docs/advanced/task-modifiers">Task Modifiers</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember904" class="ember-view" href="/docs/advanced/yieldables">Yieldables / Controlling Execution</a>
            </div>


<!---->            <div class="toc-section-title">
              Examples
            </div>
            <div class="toc-entry">
                <a id="ember905" class="ember-view" href="/docs/examples/loading-ui">Loading UI</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember906" class="ember-view" href="/docs/examples/autocomplete">Type-Ahead Search</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember907" class="ember-view" href="/docs/examples/increment-buttons">Accelerating Increment Buttons</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember908" class="ember-view" href="/docs/examples/ajax-throttling">AJAX Throttling</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember909" class="ember-view" href="/docs/examples/route-tasks">Route Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember910" class="ember-view" href="/docs/examples/joining-tasks">Awaiting Multiple Child Tasks</a>
            </div>


<!---->      </div>
    </div>
    <div class="nine columns">
      <div class="row">
    <p class="u-pull-left">
      Previous: <a id="ember911" class="ember-view" href="/docs/faq">FAQ &amp; Fact Sheet</a>
    </p>

    <p class="u-pull-right">
      Next: <a id="ember912" class="ember-view" href="/docs/advanced/lifecycle-events">Lifecycle Events</a>
    </p>
</div>

      <a class="github-edit" href="https://github.com/machty/ember-concurrency/edit/master/tests/dummy/app/docs/advanced/encapsulated-task/template.hbs" title="Edit on GitHub">
  <i class="icon-pencil"></i>
</a>


      <h3>Encapsulated Tasks</h3>

<p>
  Normally, you define tasks by decorating a generator function like
  <code>@task *myGeneratorFn() { /* ... */ }</code>.
  Occasionally, you may want to be able to expose additional state of the task,
  e.g. you might want to show the percentage progress of an <code>uploadFile</code> task,
  but unless you're using the techniques described below there's no good
  place to expose that data to the template other than to set some properties
  on the host object, but then you lose a lot of the benefits of encapsulation
  in the process.
</p>

<p>
  In cases like these, you can use Encapsulated Tasks, which behave just
  like regular tasks, but with one crucial difference: the value
  of <code>this</code> within the task function points to the currently
  running TaskInstance, rather than the host object that the task lives on
  (e.g. a Component, Controller, etc). This allows for some nice patterns
  where all of the state produced/mutated by a task can be contained (encapsulated)
  <em>within</em> the Task itself, rather than having to live on the host
  object.
</p>

<p>
  To create an encapsulated task, decorate an object (instead of a generator function)
  with the <code>@task</code> decorator that defines a <code>perform</code>
  generator function. The object can also contain initial values for task state,
  as well as computed properties and anything else supported by classic Ember objects.
</p>

<pre id="ember913" class="javascript ember-view">import { task } from 'ember-concurrency';

export default class EncapsulatedTaskComponent extends Component {
  outerFoo = 123;

  @task *regularTask(value) {
    // this is a classic/regular ember-concurrency task,
    // which has direct access to the host object that it
    // lives on via `this`
    console.log(this.outerFoo); // =&gt; 123
    yield doSomeAsync();
    this.set('outerFoo', value);
  }

  @task encapsulatedTask = {
    innerFoo: 456,

    // this `*perform() {}` syntax is valid JavaScript shorthand
    // syntax for `perform: function * () {}`

    *perform(value) {
      // this is an encapulated task. It does NOT have
      // direct access to the host object it lives on, but rather
      // only the properties defined within the POJO passed
      // to the `task()` constructor.
      console.log(this.innerFoo); // =&gt; 456

      // `this` is the currently executing TaskInstance, so
      // you can also get classic TaskInstance properties
      // provided by ember-concurrency.
      console.log(this.isRunning); // =&gt; true

      yield doSomeAsync();
      this.set('innerFoo', value);
    },
  }
}
</pre>

<h3>Live Example</h3>

<p>
  This example demonstrates how to use encapsulated tasks to
  model file uploads. It keeps all of the upload state <em>within</em>
  each TaskInstance, and uses <a id="ember914" class="ember-view" href="/docs/derived-state">Derived State</a>
  to expose the values set within the encapsulated tasks.
</p>

<p>
  <button type="button">
    Start Upload
  </button>
</p>

<h5>Queued Uploads: 0</h5>

  <h5>
    Uploading to  ():
    %
  </h5>

<!---->

<pre id="ember915" class="javascript ember-view">import { task, timeout } from 'ember-concurrency';

export default class EncapsulatedTaskController extends Controller {
  @task({ enqueue: true }) uploadFile = {
    progress: 0,
    url: null,

    stateText: computed('progress', function () {
      let progress = this.progress;
      if (progress &lt; 49) {
        return 'Just started...';
      } else if (progress &lt; 100) {
        return 'Halfway there...';
      } else {
        return 'Done!';
      }
    }),

    *perform(makeUrl) {
      this.set('url', makeUrl());

      while (this.progress &lt; 100) {
        yield timeout(200);
        let newProgress = this.progress + Math.floor(Math.random() * 6) + 5;
        this.set('progress', Math.min(100, newProgress));
      }

      return '(upload result data)';
    },
  };

  makeRandomUrl() {
    return `https://www.${randomWord()}.edu`;
  }
}
</pre>
<pre id="ember916" class="htmlbars ember-view">&lt;p&gt;
  &lt;button {{on "click" (perform this.uploadFile this.makeRandomUrl)}} type="button"&gt;
    Start Upload
  &lt;/button&gt;
&lt;/p&gt;

&lt;h5&gt;Queued Uploads: {{this.uploadFile.numQueued}}&lt;/h5&gt;

{{#let this.uploadFile.last as |encapsTask|}}
  &lt;h5&gt;
    Uploading to {{encapsTask.url}} ({{encapsTask.stateText}}):
    {{encapsTask.progress}}%
  &lt;/h5&gt;
{{/let}}

{{#if this.uploadFile.lastSuccessful}}
  &lt;h5 style="color: green;" {{! template-lint-disable no-inline-styles }}&gt;
    &lt;strong&gt;
      Upload to {{this.uploadFile.lastSuccessful.url}}:
      {{this.uploadFile.lastSuccessful.value}}
    &lt;/strong&gt;
  &lt;/h5&gt;
{{/if}}
</pre>


      <br> <br> <br> <br>

      <div class="row">
    <p class="u-pull-left">
      Previous: <a id="ember917" class="ember-view" href="/docs/faq">FAQ &amp; Fact Sheet</a>
    </p>

    <p class="u-pull-right">
      Next: <a id="ember918" class="ember-view" href="/docs/advanced/lifecycle-events">Lifecycle Events</a>
    </p>
</div>

    </div>
  </div>
</div>


<div id="ember919" class="ember-notify-cn ember-notify-default ember-view"><!----></div>
<script type="x/boundary" id="fastboot-body-end"></script>

    <script src="/assets/vendor-8b9fdb2df219a6e3ad2b83d48a176353.js"></script>
    <script src="/assets/dummy-fb9e4ad6636ed34cf5880dfc32d2c328.js"></script>

    
  </body>
</html>
