<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ember-concurrency</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
<meta name="dummy/config/environment" content="%7B%22modulePrefix%22%3A%22dummy%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%2F%22%2C%22locationType%22%3A%22auto%22%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_APPLICATION_TEMPLATE_WRAPPER%22%3Afalse%2C%22_DEFAULT_ASYNC_OBSERVERS%22%3Atrue%2C%22_JQUERY_INTEGRATION%22%3Afalse%2C%22_TEMPLATE_ONLY_GLIMMER_COMPONENTS%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22ember-concurrency%22%2C%22version%22%3A%222.3.0%2B7d13c3bd%22%7D%2C%22fastboot%22%3A%7B%22hostWhitelist%22%3A%5B%7B%7D%2C%22ember-concurrency.com%22%5D%7D%2C%22exportApplicationGlobal%22%3Afalse%7D" />
<!-- EMBER_CLI_FASTBOOT_TITLE -->

    <link integrity="" rel="stylesheet" href="/assets/vendor-e754b247f0b14ad5fde0f302404dd7cb.css">
    <link integrity="" rel="stylesheet" href="/assets/dummy-57e0f95836c2c702fadf0c8166e5d1e5.css">
    <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

    
  </head>
  <body>
    <script type="x/boundary" id="fastboot-body-start"></script><div class="container navbar">
  <div class="row">
    <div class="ten columns">
      <h3 style="float:left;">
        ember-concurrency

        <span style="font-size: 0.5em;">
          (v 2.3.0)
        </span>
      </h3>
    </div>
    <div class="one columns">
      <div class="nav-bar-link-outer">
        <a href="/api">API</a>
      </div>
    </div>
    <div class="one columns">
      <div class="nav-bar-link-outer">
        <a href="https://github.com/machty/ember-concurrency" target="_blank" rel="noopener noreferrer">GitHub</a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="docs row">
    <div class="three columns">
      <div class="side-menu">
            <div class="toc-entry">
                <a id="ember726" class="ember-view" href="/docs/introduction">Home</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember727" class="ember-view" href="/docs/installation">Installation</a>
            </div>


<!---->            <div class="toc-section-title">
              Introduction
            </div>
            <div class="toc-entry">
                <a id="ember728" class="ember-view" href="/docs/tutorial">Writing Code Without Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember729" class="ember-view" href="/docs/tutorial/discussion">Post-Mortem</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember730" class="ember-view" href="/docs/tutorial/refactor">Refactoring With Tasks</a>
            </div>


<!---->            <div class="toc-section-title">
              Reference
            </div>
            <div class="toc-entry">
                <a id="ember731" class="ember-view" href="/docs/task-function-syntax">Defining Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember732" class="ember-view" href="/docs/task-concurrency">Task Modifiers</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember733" class="ember-view" href="/docs/cancelation">Cancellation</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember734" class="ember-view" href="/docs/error-vs-cancelation">Handling Errors</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember735" class="ember-view" href="/docs/child-tasks">Child Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember736" class="ember-view" href="/docs/derived-state">Derived State</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember737" class="ember-view" href="/docs/events">Awaiting Events / Conditions</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember738" class="ember-view" href="/docs/testing-debugging">Testing &amp; Debugging</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember739" class="ember-view" href="/docs/typescript">TypeScript</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember740" class="ember-view" href="/docs/faq">FAQ &amp; Fact Sheet</a>
            </div>


<!---->            <div class="toc-section-title">
              Advanced
            </div>
            <div class="toc-entry">
                <a id="ember741" class="ember-view" href="/docs/task-concurrency-advanced">Using maxConcurrency</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember742" class="ember-view active" href="/docs/advanced/lifecycle-events">Lifecycle Events</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember743" class="ember-view" href="/docs/advanced/task-modifiers">Task Modifiers</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember744" class="ember-view" href="/docs/advanced/yieldables">Yieldables / Controlling Execution</a>
            </div>


<!---->            <div class="toc-section-title">
              Examples
            </div>
            <div class="toc-entry">
                <a id="ember745" class="ember-view" href="/docs/examples/loading-ui">Loading UI</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember746" class="ember-view" href="/docs/examples/autocomplete">Type-Ahead Search</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember747" class="ember-view" href="/docs/examples/increment-buttons">Accelerating Increment Buttons</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember748" class="ember-view" href="/docs/examples/ajax-throttling">AJAX Throttling</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember749" class="ember-view" href="/docs/examples/route-tasks">Route Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a id="ember750" class="ember-view" href="/docs/examples/joining-tasks">Awaiting Multiple Child Tasks</a>
            </div>


<!---->      </div>
    </div>
    <div class="nine columns">
      <div class="row">
    <p class="u-pull-left">
      Previous: <a id="ember751" class="ember-view" href="/docs/task-concurrency-advanced">Using maxConcurrency</a>
    </p>

    <p class="u-pull-right">
      Next: <a id="ember752" class="ember-view" href="/docs/advanced/task-modifiers">Task Modifiers</a>
    </p>
</div>

      <a class="github-edit" href="https://github.com/machty/ember-concurrency/edit/master/tests/dummy/app/docs/advanced/lifecycle-events/template.hbs" title="Edit on GitHub">
  <i class="icon-pencil"></i>
</a>


      <h3>Task lifecycle events</h3>

<p>
  ember-concurrency implements a number of lifecycle events that allow
  for a host object to react to various changes in task instance lifecycle.
  Using lifecycle hooks allows for adding things like instrumentation to tasks
  or for separating and reusing error handling code across different tasks.
  Using the <code>evented</code> modifier will enable tasks to fire lifecycle
  events on their host objects.
</p>

<p>
  In the below example, we refactor the
  <a id="ember753" class="ember-view" href="/docs/examples/ajax-throttling">AJAX throttling example</a> to use
  task events for logging of the <code>ajaxTask</code>'s state changes, instead
  of doing it manually in the looping task itself.
</p>

<h3>Live Example</h3>

<div>
  <ul>
<!---->  </ul>
</div>


<pre id="ember754" class="javascript ember-view">const COLORS = [
  '#0000FF',
  '#8A2BE2',
  '#A52A2A',
  '#DC143C',
  '#20B2AA',
  '#FF1493',
  '#228B22',
  '#DAA520',
];

function loopingAjaxTask(id) {
  return function* () {
    while (true) {
      try {
        yield this.ajaxTask.perform(id);
      } catch (e) {
        // Ignoring AJAX failures because we're being naughty.
      }
      yield timeout(2000);
    }
  };
}

export default class TaskLifecycleEventsExample extends Component {
  tagName = '';

  logs = [];

  constructor() {
    super(...arguments);

    addListener(this, 'ajaxTask:started', this, this.ajaxTaskStarted);
    addListener(this, 'ajaxTask:succeeded', this, this.ajaxTaskSucceeded);
    addListener(this, 'ajaxTask:errored', this, this.ajaxTaskErrored);
  }

  willDestroy() {
    super.willDestroy(...arguments);

    removeListener(this, 'ajaxTask:started', this, this.ajaxTaskStarted);
    removeListener(this, 'ajaxTask:succeeded', this, this.ajaxTaskSucceeded);
    removeListener(this, 'ajaxTask:errored', this, this.ajaxTaskErrored);
  }

  ajaxTask = task(
    this,
    { enqueue: true, maxConcurrency: 3, evented: true },
    async () =&gt; {
      // simulate slow AJAX
      const ms = 2000 + 2000 * Math.random();
      await timeout(ms);

      if (parseInt(ms) % 7 === 0) {
        throw new Error('Unexpected matrix glitch');
      }
      return {};
    }
  );

  ajaxTaskStarted(taskInstance) {
    const [id] = taskInstance.args;
    this.log(COLORS[id], `Task ${id}: making AJAX request`);
  }

  ajaxTaskSucceeded(taskInstance) {
    const [id] = taskInstance.args;
    this.log(COLORS[id], `Task ${id}: AJAX done`);
  }

  ajaxTaskErrored(taskInstance, error) {
    const [id] = taskInstance.args;
    this.log(
      COLORS[id],
      `Task ${id}: AJAX failed because of '${error.message}'`
    );
  }

  @task({ on: 'init' }) task0 = loopingAjaxTask(0);
  @task({ on: 'init' }) task1 = loopingAjaxTask(1);
  @task({ on: 'init' }) task2 = loopingAjaxTask(2);
  @task({ on: 'init' }) task3 = loopingAjaxTask(3);
  @task({ on: 'init' }) task4 = loopingAjaxTask(4);
  @task({ on: 'init' }) task5 = loopingAjaxTask(5);
  @task({ on: 'init' }) task6 = loopingAjaxTask(6);
  @task({ on: 'init' }) task7 = loopingAjaxTask(7);

  log(color, message) {
    let logs = this.logs;
    logs.push({ color, message });
    this.set('logs', logs.slice(-7));
  }
}
</pre>


      <br> <br> <br> <br>

      <div class="row">
    <p class="u-pull-left">
      Previous: <a id="ember755" class="ember-view" href="/docs/task-concurrency-advanced">Using maxConcurrency</a>
    </p>

    <p class="u-pull-right">
      Next: <a id="ember756" class="ember-view" href="/docs/advanced/task-modifiers">Task Modifiers</a>
    </p>
</div>

    </div>
  </div>
</div>


<div id="ember757" class="ember-notify-cn ember-notify-default ember-view"><!----></div>
<script type="x/boundary" id="fastboot-body-end"></script>

    <script src="/assets/vendor-c87daf15e3c643f8beb7674a8e2b98ba.js"></script>
    <script src="/assets/dummy-962e52c101efb3f1656d1ae7c98b5d37.js"></script>

    
  </body>
</html>
